# Sistema de Gestión de Notas - RRHH

## Descripción del proyecto

Sistema web para gestión y seguimiento de notas que ingresan a una oficina
de Recursos Humanos. Problema principal: falta de trazabilidad y seguimiento
formal de notas.

## Stack tecnológico

- Backend: Django 4.x + Django REST Framework
- Frontend: Vue 3 + Vite + PrimeVue + Tailwind CSS
- Base de datos: PostgreSQL 15
- Servidor: Nginx + Gunicorn sobre Ubuntu Server 22.04
- Entorno de desarrollo: Windows con Cursor

## Roles de usuario (acceso al sistema)

1. Administrador - gestión total del sistema
2. Director - puede crear, revisar, asignar, reasignar, anular notas
3. Jefe - mismos permisos que Director en operación diaria
4. Empleado - puede crear notas, actualizar las propias asignadas
5. Solo Lectura - solo consulta y reportes

## Estados de una nota (flujo formal)

INGRESADA → EN_REVISION → ASIGNADA → EN_PROCESO → RESUELTA → ARCHIVADA

- EN_ESPERA: estado lateral desde EN_PROCESO (bloqueada por factor externo)
- DEVUELTA: desde EN_PROCESO, vuelve a ASIGNADA con nuevo responsable
- ANULADA: salida administrativa desde cualquier estado activo (solo Admin/Director)

## Transiciones de estado permitidas

- INGRESADA → EN_REVISION: Director, Jefe, Admin
- EN_REVISION → ASIGNADA: Director, Jefe, Admin (requiere elegir responsable)
- ASIGNADA → EN_PROCESO: Responsable asignado, Jefe, Director, Admin
- EN_PROCESO → EN_ESPERA: Responsable, Jefe, Director, Admin (requiere motivo)
- EN_ESPERA → EN_PROCESO: Responsable, Jefe, Director, Admin
- EN_PROCESO → DEVUELTA: Responsable, Jefe, Director, Admin (requiere motivo)
- DEVUELTA → ASIGNADA: Director, Jefe, Admin (requiere nuevo responsable)
- EN_PROCESO → RESUELTA: Responsable, Jefe, Director, Admin
- RESUELTA → ARCHIVADA: Responsable, Jefe, Director, Admin
- RESUELTA → EN_PROCESO: Director, Jefe, Admin (requiere motivo)
- Cualquier estado activo → ANULADA: Director, Admin (requiere motivo)

## Modelos de datos

### Sector

Campos: id, nombre, numero (identificador institucional), activo, descripcion
Ejemplos: RRHH=150, Secretaría Académica=129
Usado para: numeración de notas, área de origen, distribución de resoluciones

### Agente

Persona de la institución (puede o no tener acceso al sistema)
Campos: id, apellido, nombre, legajo_numero, sector_id (FK), cargo,
activo, usuario_id (FK Usuario nullable)
Nota: Agente != Usuario. Un agente puede no tener login en el sistema.

### Nota

Campos: id, numero_nota_externo (nullable), numero_nota_interno (generado siempre),
fecha_ingreso, fecha_limite (nullable), remitente, emisor_sector_id (FK nullable),
emisor_externo (string nullable), area_origen, tema, descripcion, prioridad,
estado, canal_ingreso, responsable_id (FK Usuario), creado_por_id (FK Usuario),
fecha_creacion, ultima_modificacion, anulada (bool), motivo_anulacion (nullable),
genera_resolucion (bool), numero_resolucion (nullable), fecha_resolucion (nullable)
Relación: una nota puede estar asociada a cero, uno o varios agentes (ManyToMany)

### NotaAgente (tabla intermedia)

Campos: id, nota_id (FK), agente_id (FK), observacion (nullable)

### HistorialNota (inmutable, nunca se edita ni elimina)

Campos: id, nota_id, usuario_id, fecha_hora, tipo_evento, estado_anterior,
estado_nuevo, responsable_anterior, responsable_nuevo, descripcion_cambio,
campos_modificados (JSONField)
Tipos de evento: CREACION, CAMBIO_ESTADO, REASIGNACION, EDICION, COMENTARIO,
ADJUNTO, ANULACION, DERIVACION_DESPACHO, RESOLUCION_CARGADA, DISTRIBUCION_SECTOR

### Adjunto

Campos: id, nota_id (FK), nombre_archivo, ruta_almacenamiento, tipo_mime,
tamaño_bytes, subido_por_id (FK), fecha_subida, tipo_adjunto
Tipos de adjunto: DOCUMENTO_ORIGINAL, BORRADOR_RESOLUCION, RESOLUCION_FINAL,
NOTA_ESCANEADA, OTRO

### LegajoDocumento

Vincula documentos al legajo personal del agente en el servidor de RRHH
Campos: id, agente_id (FK), nota_id (FK nullable), nombre_archivo,
ruta_servidor, tipo_documento, fecha_carga, cargado_por_id (FK Usuario)
Tipos: NOTA_ESCANEADA, RESOLUCION, ADJUNTO, OTRO
Estructura de carpetas: /legajos/{legajo_numero}/{año}/

### DistribucionResolucion

Registro de envío de copias de resolución a otros sectores
Campos: id, nota_id (FK), sector_destino_id (FK), fecha_envio,
enviado_por_id (FK), medio (EMAIL, PAPEL, SISTEMA), observaciones

## Numeración de notas

- Con expediente formal: {sector.numero}-{secuencia_anual}-{año}
  Ejemplo: 150-0042-2025
- Sin expediente (mail, WhatsApp, verbal): INT-{secuencia_anual}-{año}
  Ejemplo: INT-0015-2025
- numero_nota_interno se genera siempre automáticamente, nunca es null
- numero_nota_externo es opcional

## Flujo de resolución formal

1. Usuario adjunta borrador .docx y marca genera_resolucion=True
2. Sistema envía mail a Área de Despacho con borrador adjunto
3. Mail incluye CC a todos los usuarios de RRHH como constancia
4. Se registra evento DERIVACION_DESPACHO en historial
5. Despacho confecciona la resolución final
6. RRHH adjunta resolución final como RESOLUCION_FINAL
7. Se registra numero_resolucion y fecha_resolucion en la nota
8. Se registra evento RESOLUCION_CARGADA en historial
9. Opcionalmente se envía copia a otros sectores (DistribucionResolucion)
10. Los documentos elegidos se guardan en LegajoDocumento del/los agentes

## Configuración de mail

Variables en .env: EMAIL_HOST, EMAIL_PORT, EMAIL_HOST_USER,
EMAIL_HOST_PASSWORD, EMAIL_USE_TLS, EMAIL_DESTINATARIO_DESPACHO
Servidor SMTP: por definir (Gmail, Outlook institucional u otro)

## Reglas de negocio críticas

- Nunca se borra una nota físicamente
- El historial es inmutable
- Toda nota pasa por EN_REVISION antes de asignarse
- Director y Jefe pueden autoasignarse notas
- El responsable archiva directamente sin validación adicional
- DEVUELTA, EN_ESPERA y ANULADA requieren motivo obligatorio
- numero_nota_interno se genera siempre, nunca es null
- Una nota puede tener cero, uno o varios agentes asociados

## Permisos por rol

- Crear nota: Admin, Director, Jefe, Empleado
- Ver todas las notas: Admin, Director, Jefe, Solo Lectura
- Ver solo propias/asignadas: Empleado
- Asignar/Reasignar: Admin, Director, Jefe
- Cambiar estado: según tabla de transiciones
- Anular nota: Admin, Director
- Eliminar físicamente: nadie
- Gestionar usuarios y sectores: solo Admin
- Gestionar agentes: Admin, Director, Jefe
- Ver reportes: Admin, Director, Jefe, Solo Lectura
- Derivar a Despacho: Admin, Director, Jefe
- Cargar en legajo: Admin, Director, Jefe
- Distribuir resolución a sectores: Admin, Director, Jefe

## Convenciones de código

- Python: PEP8, 4 espacios, snake_case
- Vue: Composition API, <script setup>, camelCase para props
- API REST: endpoints en español siguiendo el modelo de datos
- Variables de entorno en archivo .env (nunca hardcodear credenciales)
- Comentarios en español
- Commits en español con prefijos: feat, fix, refactor, docs

## Fase actual: MVP

1. Registro de notas con numeración automática
2. Flujo completo de estados con transiciones controladas
3. Asignación y reasignación de responsables
4. Asociación de agentes a notas (cero, uno o varios)
5. Historial inmutable de movimientos
6. Carga de adjuntos con tipos definidos
7. Listado de notas pendientes por persona
8. Listado de notas atrasadas
9. Login con roles y control de sesiones
10. Panel administrativo básico
11. Gestión de sectores y agentes

## Fuera del MVP — Fase 2

- Envío de mail automático para derivación a Despacho
- Notificaciones por mail al asignar nota o al vencer fecha límite
- Distribución de resoluciones a sectores con registro
- Carga de documentos en legajo personal del servidor de RRHH
- Reportes mensuales exportables
- Búsqueda avanzada con múltiples filtros

## Mejoras futuras — Fase 3

- Dashboard con indicadores clave (PrimeVue Cards + Chart.js)
- Integración automática con buzón de mail entrante
- Integración con sistema de resoluciones externo vía API
- Extensión a otras áreas de la institución
- Sistema de gestión documental completo
- Docker para despliegue
- App móvil o PWA
- MinIO para almacenamiento de adjuntos en escala
- Firma digital
